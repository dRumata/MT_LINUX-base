## LAB19-1. Troubleshooting

#### 1. Восстановление работоспособности системы после массового сбоя конфигураций
1. Перед выполнением практической работы скопируйте и запустите от имени root скрипт [**lab19prep.sh**]
(https://github.com/dRumata/LINUX-base-micdit/raw/main/M19-tshoot/lab19prep.sh)

2. Перезагрузите сервер: сервер не загружается

3. Во время загрузки в биос выберите загрузку с **CD-Rom**

4. В меню инсталяционного диска выберите **`Troubleshooting`**. Затем **`Rescue a Fedora system`**

5. Внимательно прочитайте текст после фразы **Rescue**, запишите для себя, куда будет смонтирован корневой раздел найденной системы.

6. Выберите пункт **`1) Continue`**

7. Внимательно прочитайте текст после фразы **Rescue Shell**, запишите для себя, как сделать корневой раздел найденной системы активным
Нажмите **`Enter`**

8. Проверьте содержимое **/etc/fstab** (помните, что сейчас этот файл находится по другому абсолютному пути)
> Подсказка: Смотрите [решение](#Решение)

>![Screenshot](../img/scr.png)
***Cделайте скриншот экрана c результатом выполнения задания для отправки отчета.***

9. Какого обязательного раздела не хватает?

10. Добавьте строку для монтирования этого раздела. Используйте команду lsblk, blkid, >>, vi
> Подсказка: Смотрите [решение](#Решение)

11. Сохраните **fstab** и перезагрузите систему (используйте `reboot`)

12. Если система загружается с инсталяцционного диска выберите **`Troubleshooting`** и затем **`Boot first drive`**

13. Если система не загрузилась и вы видите сообщение  **`Grub >`**, следовательно можно предположить, что это проблема конфигурации загрузчика.

14. Повторите шаги с **4** по **7**.

15. Проверьте с помощь **lsblk**, что у нас корректно смонтирован раздел **/boot**

16. Проверьте содержимое **/mnt/sysroot/boot/grub2/grub.cfg**

17. Если файл содержит некорректную запись (в нашем случае, он пустой и не содержит конфигурации), то необходимо пересоздать конфигурацию загрузчика

18. Вспомните сообщение о **chroot** после **7**-го шага. Смонтируйте корневой раздел восстанавливаемой системы.
```
chroot /mnt/sysroot
```
19. Пересоздайте конфигурацию **grub2** c помощью команды **grub2-mkconfig**
> Подсказка: Смотрите [решение](#Решение)

20. Выйдите из **chroot** - возвращает использование корневого раздела с диска восстановления.
```
exit
```
21. Перезагрузите сервер.

22. Возможно во время перезагрузки прийдется перезагрузиться несколько раз и дождаться когда будут пересозданы метки **SELinux**.

23. Войдите в систему. Успешно? Ваш пароль не работает, верните управление сервером, сменив пароли.

24. Смените пароли для вашего пользователя и для root. Для этого перезагрузите снова сервер и воспользуйтесь диском восстановления и коммандой **chroot**. Затем используйте команду **passwd** для смены пароля.

25. Смените загрузку "по-умолчанию" на графическую сессию. Перезагрузите сервер.
> Подсказка: Смотрите [решение](#Решение)

26. Проверьте, доступен ли по-сети сервер **kernel.org**

27. Проверьте настройки сетевой карты.

28. Внесите изменения в настройки сети. Добейтесь того, чтобы сайт **https://kernel.org** открывался в браузере.
>![Screenshot](../img/scr.png)
***Cделайте скриншот экрана c результатом выполнения задания для отправки отчета.***

#### 2. Troubleshooting адресов в сети
29. Создадим список всех хостов и их IP-адресов, находящихся в вашей сети, а также проверим MAC-адреса и открытые порты.
Команда fping последовательно проверяет все адреса в заданном диапазоне. В следующем примере она исследует подсеть, сообщает, какие узлы активны, запрашивает имена узлов в DNS и выводит сводку:
```
fping -c1 -gAds 172.16.110.0/24 2>1 | egrep -v "ICMP|xmt" >> fping.txt
```

30. nmap решает аналогичную задачу, но производит менее подробный вывод:
```
sudo nmap -sn 172.16.110.0/24 > nmap.txt
```

31. Информация представлена в довольно удобочитаемом виде, но можно добавить для удобства пустые строки перед каждым хостом и сохранить результат в другом файле:
```
awk '/Nmap/{print ""}1' nmap.txt > nmap2.txt
```

32. Проверьте наличие открытых портов на хостах в вашей сети:
```
sudo nmap -sS 172.16.110.*
```

33. Соберите список хостов и их IP-адресов:
```
nmap -sn 172.16.110.0/24 | grep 'Nmap scan report for' |cut -d' ' -f5,6
```

34. Ответьте для себя на вопрос: все ли ключи вы знаете, которые были использованы в предыдущих командах.
35. Составьте таблицу в файле lab19-task6.key.txt и сохраните снимок экрана с содержимым этого файла.
```
nmap
-sn значение

cut
-d значение
-f значение
```
>![Screenshot](../img/scr.png)
***Cделайте скриншот экрана c результатом выполнения задания для отправки отчета.***


#### 3. Troubleshooting ошибок RPM

36. Сначала проверьте состояние службы httpd, чтобы узнать, запущена ли она. Используйте `systemctl`

37. Если службы httpd нет, то установите ее воспользовавшись командой dnf install. После этого убедитесь что служба запустилась.

38. Остановите службу httpd.

39. Внесите изменения в файл /usr/sbin/httpd
```
sudo echo lab19|sudo tee /usr/sbin/httpd
```
40. Запустите службу httpd

41. Прочтите сообщения об ошибке в журнале. Используйте команду journalctl и ключ -u

42. Уточните какому пакету соответствует файл /usr/sbin/httpd
```
rpm -qf /usr/sbin/httpd
```

43. Сверьте файл /usr/sbin/httpd с оригинальным в соответствующем пакете. Имя пакета используйте из предыдущего шага.
```
sudo rpm -V имя_пакета
```

44. Найдите информацию о атрибутах сверки, отображенных в отчете и сделайте скриншот документации man rpm, с оббъяснением значения атрибутов проверки файла.
>![Screenshot](../img/scr.png)
***Cделайте скриншот экрана c результатом выполнения задания для отправки отчета.***

#### Решение
Решение доступно в файле  [lab19-1tshoot.help.md](lab19-1.tshoot.help.md)