## LAB18-1. 

#### 1 Использование реального мониторинга лог файла и команды logger 

1. Откройте шелл как root. 2. В оболочке root введите tail -f /var/log/messages. 3. Откройте второе окно терминала. В этом окне терминала введите su - student, чтобы открыть подоболочку от имени пользователя student. 4. Наберите su - чтобы открыть shell root, и введите неправильный пароль. 5. Обратите внимание, что в /var/log/messages ничего не отображается. Это потому, что здесь не записываются ошибки, связанные с входом в систему. 6. В командной строке пользователя student введите logger hello. Вы увидите сообщение, появляющееся в файле /var/log/messages в реальном времени. 7. В терминале, где выполняется команда tail -f нажмите Ctrl-C, чтобы остановить отслеживание файла сообщений. 8. Введите tail -20 /var/log/secure. Вывод команды показывает последние 20 строк в файле /var/log/secure, которые покажут в том числе сообщения, которые ранее были сгенерированы ошибками su- password.
>![Screenshot](../img/scr.png)
***Cделайте скриншот экрана c результатом выполнения задания для отправки отчета.***

#### 2. 2. Изменение правил rsyslog.conf 

1. По умолчанию служба Apache не регистрируется через rsyslog, но ведет собственный журнал. Вы собираетесь это изменить. Для начала введите yum install -y httpd, чтобы установить службу Apache. 2. После установки службы Apache откройте его файл конфигурации /etc/http/conf/httpd.conf и добавьте в него следующую строку: ErrorLog syslog:local1 3. Введите systemctl restart httpd. 4. Создайте строку в файле rsyslog.conf, которая будет отправлять все сообщения, которые он получает для объекта local1 (которое теперь используется службой httpd), в файл /var/log/httpd-error.log. Для этого включите следующую строку: local1.error /var/log/httpd-error.log 5. Скажите rsyslogd перезагрузить его конфигурацию, используя команду systemctl restart rsyslog.
6. Все сообщения об ошибках Apache теперь будут записываться в файл httpd-error.log. 7. В браузере Firefox или другом перейдите по адресу http:// localhost. Поскольку страницы index.html еще нет, она будет записана в журнал ошибок. 8. Создайте файл объекта, который также записывает сообщения отладки в определенный файл. Для этого введите echo "*.debug /var/log/messages-debug">/etc/rsyslog.d/debug.conf. 9. Снова перезапустите rsyslogd с помощью команды systemctl restart rsyslog. 10. Используйте команду tail -f /var/log/messages-debug, чтобы открыть отслеживание только что созданного файла. 11. Введите logger -p daemon.debug «Daemon Debug Message». Вы увидите прохождение отладочного сообщения. 12. Нажмите Ctrl-C, чтобы закрыть файл журнала отладки.

#### 3. Изучение journalctl 
1. Введите journalctl. Вы увидите содержимое журнала с момента последнего запуска вашего сервера, начиная с начала журнала. Содержимое файла отображается через утилиту less, поэтому вы можете использовать обычные команды less для просмотра файла. 2. Введите q, чтобы выйти из пейджера. Теперь введите journalctl --no-pager. Это показывает содержимое журнала без использования утилиты less. 3. Введите journalctl -f. Это открывает режим просмотра в реальном времени journalctl, который позволяет вам видеть новые сообщения, которые прокручиваются в реальном времени. Нажмите Ctrl-C, чтобы прервать вывод информации. 4. Введите journalctl и дважды нажмите клавишу TAB. Здесь показаны конкретные параметры, которые можно использовать для фильтрации. Введите, например,journalctl_UID=1000, чтобы показать сообщения, которые были зарегистрированы для вашей учетной записи пользователя. 5. Введите journalctl -n 20. Параметр -n 20 отображает последние 20 строк журнала (как и tail -n 20). 6. Введите journalctl -p err. Эта команда показывает только ошибки. 7. Если вы хотите просмотреть сообщения журнала, написанные за определенный период времени, вы можете использовать команды --since и --until. Обе опции принимают параметр времени в формате YYYY-MM-DD hh:mm:ss (ГГГГ-ММ-ДД чч: мм: сс). Кроме того, вы можете использовать yesterday, today, and tomorrow (вчера, сегодня и завтра) в качестве параметров. Итак, введите journalctl --since yesterday, чтобы отобразить все сообщения, написанные со вчерашнего дня. 8. journalctl также позволяет комбинировать различные варианты. Итак, если вы хотите отобразить все сообщения с приоритетом err, которые были написаны со вчерашнего дня, используйте ournalctl --since yesterday -p err. 9. Если вам нужно как можно больше подробностей, используйте journalctl -o verbose. Здесь показаны различные варианты, которые используются при записи в журнал (см. Пример 13-6). Все эти параметры можно использовать, чтобы указать команде journalctl, какую конкретную информацию вы ищете. Введите, например, journalctl _SYSTEMD_UNIT=sshd.service, чтобы отобразить дополнительную информацию о модуле sshd Systemd. 10. Введите journalctl --dmesg. Это показывает только сообщения, относящиеся к ядру. Не многие люди используют эту команду, поскольку команда dmesg дает точно такой же результат.

#### 4. 4. Как сделать journald постоянным 

1. Откройте shell как root и введите mkdir /var/log/journal. 2. Прежде чем journald сможет записать журнал в этот каталог, вы должны установить владельца. Введите chown root: systemd-journal /var/log/journal, а затем chmod 2755 /var/log/journal. 3. Затем вы можете либо перезагрузить систему (перезапуска службы systemd-journald недостаточно), либо использовать команду killall -USR1 systemd-journald. 4. Журнал Systemd теперь сохраняется после перезагрузки. Если вы хотите увидеть сообщения журнала с момента последней перезагрузки, используйте journalctl -b.

#### 5 Создание сервера журналирования с помощью systemd

Когда systemd-journal-remote будет установлен, отредактируйте /etc/systemd/ journal-remote.conf на сервере. Я предпочитаю хранить ключи шифрования и сертификаты в /etc/pki/journald/: [Remote] Seal=false SplitMode=host ServerKeyFile=/etc/pki/journald/log-server.key ServerCertificateFile=/etc/pki/journald/log-server.crt TrustedCertificateFile=/etc/pki/journald/ca.crt Установите разрешения на доступ к ключам и сертификатам сервера: $ sudo chmod -R 0755 /etc/pki/journald $ sudo chmod 0440 /etc/pki/journald/log-server.key Измените группу-владельца закрытого ключа сервера на systemd-journal-remote: $ sudo chgrp systemd-journal-remote /etc/pki/journald/log-server.key

